name: Tagged Release

on:
  push:
    tags:
      - "*"
jobs:
  publish:
    name: Publish release
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Compile
      run: |
        echo "tagname: $GITHUB_REF_NAME"
        cd src
        gcc -O3 helloworld.c -o helloworld
        cd ..
        mkdir -p helloworld-$GITHUB_REF_NAME/usr/local/bin
        mkdir -p helloworld-$GITHUB_REF_NAME/DEBIAN
        cp DEBIAN/control helloworld-$GITHUB_REF_NAME/DEBIAN
        cp src/helloworld helloworld-$GITHUB_REF_NAME/usr/local/bin

        sudo chown -R 0:0 helloworld-$GITHUB_REF_NAME/
        dpkg -b helloworld-$GITHUB_REF_NAME
    - uses: actions/checkout@v4
      name: Upload to ppa
      with:
        repository: JayPi4c/ppaDemo
        path: ppaDemo
        # ref: 'main'
        # token:  ${{ secrets.ACTIONS_GITHUB_TOKEN }}
    - name: setup git config
      run: |
        git config user.name "GitHub Actions Bot"
        git config user.email "<>"
        cp helloworld-$GITHUB_REF_NAME.deb ppaDemo/
        cd ppaDemo
        git add .
        git commit -m "Add new version"
        git push